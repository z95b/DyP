<!DOCTYPE html>
<html lang="es">

<head>
  <link rel="icon" href="media/ico.ico" type="image/x-icon">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Razas DyP</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet" />

  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet" />

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --neon-red: #ff003c;
      --neon-gold: #ffb300;
      --chrome: #e8e8e8;
    }


    body {
      font-family: "Verdana", monospace;
      background: linear-gradient(135deg, #1a1a1a, #2b2b2b);
      color: #f4f4f4;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .button {
      padding: 12px 24px;
      background: rgba(0, 0, 0, 0.2);
      border: solid 1px whitesmoke;
      color: #fff;
      font-weight: bold;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1rem;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
      transition: background 0.3s ease, transform 0.2s ease;
    }

    #divBtnTop button {
      background: rgba(0, 0, 0, 0.2);
      border: solid 1px whitesmoke;
      color: #fff;
      margin: 0;
      padding: 0;
      border-radius: 0px;
      height: 7.5rem;
      width: 7.5rem;

    }

    #divBtnTop button:hover {
      background: rgba(45, 45, 45, 0.2);

    }


    /* Estilos para los botones de filtro y ordenación */
    .filter-button,
    .sort-button {
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--neon-gold);
      color: var(--neon-gold);
      font-weight: bold;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    }

    .filter-button:hover,
    .sort-button:hover {
      background: rgba(255, 179, 0, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 0 10px var(--neon-gold);
    }

    .filter-button.active,
    .sort-button.active {
      background: rgba(255, 179, 0, 0.4);
      border-color: var(--neon-red);
      color: var(--neon-red);
      box-shadow: 0 0 15px var(--neon-red);
    }

    /* Estilos para la barra de búsqueda */
    #searchBar {
      padding: 10px 40px 10px 10px;
      width: 100%;
      font-size: 1rem;
      border: 1px solid var(--neon-gold);
      border-radius: 10px;
      background-color: rgba(0, 0, 0, 0.3);
      color: var(--neon-gold);
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    #searchBar:focus {
      border-color: var(--neon-red);
      box-shadow: 0 0 10px var(--neon-red);
      outline: none;
    }

    

    #characters {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      margin-top: 30px;
      justify-content: center;
      max-width: 1200px;
    }

    .character-container {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      width: 100%;
      background: #242424;
      border-radius: 15px;
      box-shadow: 0px 8px 30px rgba(0, 0, 0, 1);
      border: 1px solid #444;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      /* Necesario para los efectos */
      border-radius: 15px;
      overflow: auto;
    }

    .character-image {
      flex: 1;
      width: 33%;
      background-size: cover;
      background-position: center;
    }

    .character-content {
      flex: 2;
      padding: 20px;
      color: #f4f4f4;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
    }

    /* Superposición para oscurecer el fondo */
    .character-content::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.70);
      /* Oscurecimiento normal */
      z-index: 1;
    }

    /* Contenido sobre el fondo */
    .character-content>* {
      position: relative;
      z-index: 2;
    }

    .character-description {
      color: #ccc;
      background-color: rgba(0, 0, 0, 0.3);
    }

    .character-size {
      display: inline-block;
      margin: 5px;
      padding: 5px 10px;
      border: 1px solid white;
      border-radius: 5px;
      text-align: center;
      background-color: #444;
      color: white;
    }

    .character-attributes {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin-top: 15px;
      margin-bottom: 15px;
      flex-wrap: wrap;
      font-size: 1.2rem;

    }

    .character-attribute {
      margin-top: 0 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 60px;
      height: 60px;
      clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
      /* Forma de rombo */
      background: #333;
      color: #ffa726;
      text-align: end;
      position: sticky;
    }

    .character-attribute span {
      margin-top: 10%;
    }


    .habilities-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    .hability {
      background: #333;
      padding: 10px;
      border-radius: 10px;
      color: AntiqueWhite;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
      font-family: "Verdana", Courier, monospace;
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #form-container {
      width: 100%;
      max-width: 600px;
      background: #242424;
      padding: 3%;
      border-radius: 15px;
      color: #fff;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
      max-height: 90vh;
      overflow-y: auto;
    }

    #form-container h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #ffa726;
    }

    .form-group {
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .form-group label {
      font-weight: bold;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      background: #333;
      border: 1px solid #444;
      border-radius: 5px;
      color: #fff;
    }

    .form-group input[type="checkbox"] {
      width: auto;
    }

    #abilitiesContainer .ability-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    #abilitiesContainer .ability-group input,
    #abilitiesContainer .ability-group textarea {
      flex: 1;
    }

    #abilitiesContainer .ability-group button {
      background: #ff9f43;
      border: none;
      color: #fff;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 5px;
    }

    #abilitiesContainer .ability-group button:hover {
      background: #ff6f00;
    }

    #form-container button[type="button"] {
      margin-top: 15px;
      width: 100%;
    }

    .character-title {
      font-family: "Cinzel Decorative", serif;
      font-size: 2rem;
      color: #ffd700;
      text-align: center;
      margin-bottom: 15px;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
      letter-spacing: 2px;
    }


    .title-container {
      text-align: center;
    }

    @keyframes neonFlicker {

      0%,
      19%,
      21%,
      23%,
      25%,
      54%,
      56%,
      100% {
        opacity: 1;
      }

      20%,
      22%,
      24%,
      55% {
        opacity: 0.5;
      }
    }

    .neon-sign {
      position: relative;
      display: inline-block;
      font-family: 'Cinzel', serif;
      font-size: 4rem;
      font-weight: bold;
      color: var(--neon-gold);
      text-shadow: 0 0 10px var(--neon-gold),
        0 0 20px var(--neon-gold),
        0 0 30px var(--neon-gold);
      padding: 1rem;
      animation: neonFlicker 5s infinite;
      color: #ff6f00
    }



    @media (max-width: 768px) {
      .character-container {
        width: 90%;
      }

      .character-content {
        width: 19rem;
      }

      .character-image {
        display: none;
        /* Oculta el contenedor de imagen en móviles */
      }
    }
  </style>
</head>

<body>
  <div class="casino-lights"></div>

  <div class="title-container">
    <div class="neon-sign">
      <a href="index.html">
        Dragonas y Perronas
      </a>
    </div>
  </div>

  <!-- <div id="divBtnTop">
    <a href="https://docs.google.com/document/d/1Dlcji8oR8gjisp-Uua9jirKSnK_iLwy97cX9NxeJq94/edit?tab=t.0"><button class="">DOCUMENTO</button></a>
    <button class="" onclick="mostrarFormulario()">GENERAR RAZA</button>
  </div> -->

  <div id="overlay" onclick="cerrarFormulario()">
    <div id="form-container" onclick="event.stopPropagation()">
      <h2>Formulario de Razas</h2>
      <form id="raceForm">
        <div class="form-group">
          <label for="raceName">Nombre de la Raza</label>
          <input type="text" id="raceName" placeholder="Ej: Humanos" required />
        </div>
        <div class="form-group">
          <label for="raceDescription">Descripción</label>
          <textarea id="raceDescription" rows="3" placeholder="Breve descripción de la raza" required></textarea>
        </div>
        <div class="form-group">
          <label for="lifeSpan">Esperanza de Vida en Años</label>
          <input type="text" id="lifeSpan" placeholder="Ej: 200" style="width: 40%; display: flex;" required />
        </div>



        <div class="form-group">
          <label for="bonusRules">Reglas de Bonificadores</label>
          <textarea id="bonusRules" rows="2" placeholder="Ej: Seleccionar solo 1 bonificador de +2"></textarea>
        </div>
        <div class="form-group">
          <label>Bonificadores de Atributos</label>
          <input type="number" id="strength" placeholder="Fuerza" required />
          <input type="number" id="dexterity" placeholder="Destreza" required />
          <input type="number" id="constitution" placeholder="Constitución" required />
          <input type="number" id="intelligence" placeholder="Inteligencia" required />
          <input type="number" id="wisdom" placeholder="Sabiduría" required />
          <input type="number" id="charisma" placeholder="Carisma" required />
        </div>
        <div class="form-group">
          <label for="movementSpeed">Velocidad de Movimiento en Casillas</label>
          <input type="number" id="movementSpeed" placeholder="Ej: 7 casillas" required />
        </div>
        <div class="form-group">
          <label>Tamaños Disponibles</label>
          <label><input type="checkbox" value="1" /> Diminuto (0.05 - 0.50m)</label>
          <label><input type="checkbox" value="2" /> Pequeño (0.50 - 1.40m)</label>
          <label><input type="checkbox" value="3" /> Mediano (1.40 - 1.89m)</label>
          <label><input type="checkbox" value="4" /> Grande (1.90 - 2.49m)</label>
          <label><input type="checkbox" value="5" /> Enorme (2.50 - 4.49m)</label>
          <label><input type="checkbox" value="6" /> Gargantuesco (>4.50m)</label>
        </div>

        <div class="form-group">
          <label>Habilidades</label>
          <div id="abilitiesContainer"></div>
          <button type="button" onclick="addAbility()">
            + Añadir Habilidad
          </button>
        </div>
        <button type="button" class="button" onclick="generateJSON()">
          Terminar y Descargar JSON
        </button>
      </form>
    </div>
  </div>
  <hr>
  <span> Filtrar: </span>
  <!-- Filtros y ordenación -->
  <div id="filters" style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
    <button class="button filter-button" data-attribute="strength">Fuerza</button>
    <button class="button filter-button" data-attribute="dexterity">Destreza</button>
    <button class="button filter-button" data-attribute="constitution">Constitución</button>
    <button class="button filter-button" data-attribute="intelligence">Inteligencia</button>
    <button class="button filter-button" data-attribute="wisdom">Sabiduría</button>
    <button class="button filter-button" data-attribute="charisma">Carisma</button>
  </div>

  <div id="sort-options" style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
    <button class="button sort-button" data-field="raceName" data-order="asc">A-Z ↑</button>
    <button class="button sort-button" data-field="lifeSpan" data-order="asc">Esperanza de Vida ↑</button>
    <button class="button sort-button" data-field="movementSpeed" data-order="asc">Velocidad ↑</button>
    <button class="button sort-button" data-field="sizes" data-order="asc">Tamaño ↑</button>
  </div>

  <!-- Barra de búsqueda -->
  <div style="position: relative; width: 90%; max-width: 600px; margin-top: 20px;">
    <input type="text" id="searchBar" placeholder=" 🔍 Buscar por nombre de raza..." />
  </div>






  <div id="characters"></div>
  <script>
    function mostrarFormulario() {
      document.getElementById("overlay").style.display = "flex";
    }

    function cerrarFormulario() {
      document.getElementById("overlay").style.display = "none";
    }

    function addAbility() {
      const container = document.getElementById("abilitiesContainer");
      const abilityGroup = document.createElement("div");
      abilityGroup.classList.add("ability-group");
      abilityGroup.innerHTML = `
        <input type="text" placeholder="Nombre de habilidad" required style="flex: 20; ">
        <textarea placeholder="Descripción de habilidad" rows="4" required style="flex: 60;"></textarea>
        <button type="button" onclick="this.closest('.ability-group').remove()" style="background: none; border: none; cursor: pointer; color: #ff6f00; font-size: 1.5rem;flex: 1;">&times;</button>
`;
      container.appendChild(abilityGroup);
    }
    document
      .getElementById("characters")
      .addEventListener("click", (event) => {
        const container = event.target.closest(".character-container");
        if (!container) return;
        const titleElement = container.querySelector(".character-title");
        const raza = titleElement.textContent.trim();
        const baseUrl = "https://www.google.com/search";
        const query = `${raza} dungeons and dragons`;
        const params = new URLSearchParams({
          q: query,
          tbm: "isch",
          source: "lnms",
        });
        const url = `${baseUrl}?${params.toString()}`;
        window.open(url, "_blank");
      });

    function getBorderStyleForHighestAttributes(attributes, attributeColors) {
      const maxValue = Math.max(
        ...Object.values(attributes).map((v) => parseInt(v, 10) || 0)
      );
      const highestAttributes = Object.keys(attributes).filter(
        (key) => parseInt(attributes[key], 10) === maxValue
      );
      if (highestAttributes.length > 1) {
        const gradientStops = highestAttributes
          .map((attr, index) => {
            const color = attributeColors[attr];
            const percentage = (100 / highestAttributes.length) * (index + 1);
            return `${color} ${percentage}%`;
          })
          .join(", ");
        return `linear-gradient(90deg, ${gradientStops})`;
      }
      return attributeColors[highestAttributes[0]];
    }


    // Función para filtrar por atributos
    function filterCharacters() {
      const activeFilters = Array.from(document.querySelectorAll(".filter-button.active"))
        .map(button => button.getAttribute("data-attribute"));
      const characters = document.querySelectorAll(".character-container");

      characters.forEach(character => {
        const attributes = JSON.parse(character.getAttribute("data-attributes"));
        const isVisible = activeFilters.length === 0 || activeFilters.some(attr => parseInt(attributes[attr], 10) > 0);
        character.style.display = isVisible ? "" : "none";
      });
    }

    // Función para ordenar personajes
    function sortCharacters(field, order) {
      const charactersContainer = document.getElementById("characters");
      const characters = Array.from(charactersContainer.querySelectorAll(".character-container"));

      characters.sort((a, b) => {
        const dataA = JSON.parse(a.getAttribute("data-attributes"));
        const dataB = JSON.parse(b.getAttribute("data-attributes"));

        let valueA, valueB;

        if (field === "raceName") {
          valueA = a.querySelector(".character-title").textContent.toLowerCase();
          valueB = b.querySelector(".character-title").textContent.toLowerCase();
        } else if (field === "lifeSpan") {
          const lifeSpanRegex = /-(\d+)/;
          const matchA = lifeSpanRegex.exec(a.querySelector(".character-description").textContent) || [];
          const matchB = lifeSpanRegex.exec(b.querySelector(".character-description").textContent) || [];
          valueA = parseInt(matchA[1], 10) || 0;
          valueB = parseInt(matchB[1], 10) || 0;
        } else if (field === "movementSpeed") {
          valueA = parseInt(dataA.movementSpeed, 10) || 0;
          valueB = parseInt(dataB.movementSpeed, 10) || 0;
        } else if (field === "sizes") {
          valueA = Math.min(...dataA.sizes);
          valueB = Math.min(...dataB.sizes);
        }

        if (order === "asc") return valueA > valueB ? 1 : -1;
        if (order === "desc") return valueA < valueB ? 1 : -1;
        return 0;
      });

      characters.forEach(character => charactersContainer.appendChild(character));
    }

    // Event listeners para los botones de filtro
    document.querySelectorAll(".filter-button").forEach(button => {
      button.addEventListener("click", () => {
        button.classList.toggle("active");
        filterCharacters();
      });
    });

    // Event listeners para los botones de ordenación
    document.querySelectorAll(".sort-button").forEach(button => {
      button.addEventListener("click", () => {
        const field = button.getAttribute("data-field");
        const currentOrder = button.getAttribute("data-order");
        const newOrder = currentOrder === "asc" ? "desc" : "asc";

        button.setAttribute("data-order", newOrder);
        button.textContent = `${button.textContent.split(" ")[0]} ${newOrder === "asc" ? "↑" : "↓"}`;

        sortCharacters(field, newOrder);

        document.querySelectorAll(".sort-button").forEach(btn => btn.classList.remove("active"));
        button.classList.add("active");
      });
    });

    // Event listener para la barra de búsqueda
    document.getElementById("searchBar").addEventListener("input", (event) => {
      const query = event.target.value.toLowerCase();
      const characters = document.querySelectorAll(".character-container");

      characters.forEach(character => {
        const name = character.querySelector(".character-title").textContent.toLowerCase();
        character.style.display = name.includes(query) ? "" : "none";
      });
    });



    async function cargarRazas() {
      const charactersContainer = document.getElementById("characters");
      const directorio = "razas/";
      try {
        const indexResponse = await fetch(`razas_index.json`);
        if (!indexResponse.ok)
          throw new Error("No se pudo cargar el índice de razas.");
        const archivos = await indexResponse.json();
        for (const archivo of archivos) {
          const razaResponse = await fetch(`${directorio}${archivo}`);
          if (!razaResponse.ok) continue;
          const raza = await razaResponse.json();
          const container = document.createElement("div");
          container.classList.add("character-container");
          container.setAttribute("data-attributes", JSON.stringify(raza.attributes));
          const attributeColors = {
            strength: "Tomato",
            dexterity: "PaleGreen",
            constitution: "Gold",
            intelligence: "SkyBlue",
            wisdom: "MediumPurple",
            charisma: "HotPink",
          };

          const getBorderStyleForHighestAttributes = (attributes) => {
            const maxValue = Math.max(
              ...Object.values(attributes).map((v) => parseInt(v, 10) || 0)
            );
            const highestAttributes = Object.keys(attributes).filter(
              (key) => parseInt(attributes[key], 10) === maxValue
            );
            if (highestAttributes.length > 1) {
              let currentIndex = 0;

              const updateBoxShadow = () => {
                const currentAttribute = highestAttributes[currentIndex];
                const color = attributeColors[currentAttribute];
                container.style.boxShadow = `0 0 30px ${color}`;
                currentIndex = (currentIndex + 1) % highestAttributes.length;
              };
              setInterval(updateBoxShadow, 1000);
              return {
                border: `2px solid ${attributeColors[highestAttributes[0]]}`,
                boxShadow: `0 0 30px ${attributeColors[highestAttributes[0]]
                  }`,
              };
            }
            return {
              border: `2px solid ${attributeColors[highestAttributes[0]]}`,
              boxShadow: `0 0 30px ${attributeColors[highestAttributes[0]]}`,
            };
          };
          const {
            border,
            boxShadow
          } = getBorderStyleForHighestAttributes(
            raza.attributes
          );
          container.style.border = border;
          container.style.boxShadow = boxShadow;
          container.style.border = `5px solid transparent`;
          container.style.backgroundImage = border.includes("linear-gradient") ?
            border :
            `none`;
          container.style.boxShadow = `0 0 15px ${boxShadow}`;

          const content = document.createElement("div");
          content.classList.add("character-content");
          content.style.backgroundImage = `url('${directorio}${archivo.replace(
            ".json",
            ".png"
          )}')`;

          const image = document.createElement("div");
          image.classList.add("character-image");
          image.style.backgroundImage = `url('${directorio}${archivo.replace(
            ".json",
            ".png"
          )}')`;
          container.appendChild(image);
          const title = document.createElement("div");
          title.classList.add("character-title");
          title.textContent = raza.raceName.toUpperCase();
          content.appendChild(title);

          const description = document.createElement("div");
          description.classList.add("character-description");
          description.innerHTML = raza.raceDescription.replace(/\n/g, "<br>");
          content.appendChild(description);

          const lifeSpan = raza.lifeSpan || "Desconocido";




          const bonusAttributesContainer = document.createElement("div");
          bonusAttributesContainer.style.border = "1px solid LightSteelBlue";
          bonusAttributesContainer.style.borderRadius = "10px";
          bonusAttributesContainer.style.padding = "10px";
          bonusAttributesContainer.style.margin = "10px 0";
          bonusAttributesContainer.style.display = "flex";
          bonusAttributesContainer.style.flexDirection = "column";
          bonusAttributesContainer.style.alignItems = "center";
          const bonusRulesText = document.createElement("div");
          bonusRulesText.style.marginBottom = "10px";
          bonusRulesText.style.textAlign = "center";
          bonusRulesText.style.fontSize = "14px";
          bonusRulesText.textContent = raza.bonusRules;
          bonusAttributesContainer.appendChild(bonusRulesText);
          const attributes = document.createElement("div");
          attributes.classList.add("character-attributes");
          [
            "strength",
            "dexterity",
            "constitution",
            "intelligence",
            "wisdom",
            "charisma",
          ].forEach((key) => {
            const value = raza.attributes[key] || 0;
            const attribute = document.createElement("div");
            attribute.classList.add("character-attribute");
            attribute.style.border = `5px solid ${attributeColors[key]}`;
            attribute.style.marginInline = "5px";
            attribute.style.marginBlockEnd = "10px";
            attribute.style.color = attributeColors[key];

            const initialSpan = document.createElement("span");
            initialSpan.textContent =
              key[0].toUpperCase() + key[1].toUpperCase() + key[2].toUpperCase();
            initialSpan.style.position = "absolute";
            initialSpan.style.top = "5px";
            initialSpan.style.marginLeft = "auto";
            initialSpan.style.fontSize = "0.8rem";
            initialSpan.style.color = attributeColors[key];
            attribute.appendChild(initialSpan);

            const numberSpan = document.createElement("span");
            numberSpan.textContent = value;
            numberSpan.style.color = attributeColors[key];
            attribute.appendChild(numberSpan);

            attributes.appendChild(attribute);
          });

          bonusAttributesContainer.appendChild(attributes);
          content.appendChild(bonusAttributesContainer);



          const sizeSpeedContainer = document.createElement("div");
          sizeSpeedContainer.style.display = "flex";
          sizeSpeedContainer.style.justifyContent = "space-between";
          sizeSpeedContainer.style.alignItems = "center";
          sizeSpeedContainer.style.gap = "10px";
          sizeSpeedContainer.style.padding = "10px";
          sizeSpeedContainer.style.background = "linear-gradient(90deg, rgba(50, 50, 50, 0.8), rgba(30, 30, 30, 0.8))";
          sizeSpeedContainer.style.borderRadius = "10px";
          sizeSpeedContainer.style.boxShadow = "0 4px 8px rgba(0, 0, 0, 0.4)";


          const sizeMap = {
            1: "Diminuto (0.05 - 0.50m)",
            2: "Pequeño (0.50 - 1.40m)",
            3: "Mediano (1.40 - 1.89m)",
            4: "Grande (1.90 - 2.49m)",
            5: "Enorme (2.50 - 4.49m)",
            6: "Gargantuesco (>4.50m)"
          };

          const sizesDiv = document.createElement("div");
          sizesDiv.style.flex = "5";
          sizesDiv.style.display = "flex";
          sizesDiv.style.flexWrap = "wrap";
          sizesDiv.style.gap = "10px";
          sizesDiv.style.padding = "10px";
          sizesDiv.style.backgroundColor = "rgba(255, 255, 255, 0.1)";
          sizesDiv.style.borderRadius = "10px";

          raza.sizes.forEach((size) => {
            const sizeSpan = document.createElement("span");
            sizeSpan.textContent = sizeMap[size];
            sizeSpan.style.fontSize = "1rem";
            sizeSpan.style.color = "#fff";
            sizeSpan.style.padding = "5px 10px";
            sizeSpan.style.background = "rgba(0, 0, 0, 0.5)";
            sizeSpan.style.borderRadius = "5px";
            sizeSpan.style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.3)";
            sizesDiv.appendChild(sizeSpan);
          });

          const lifeSpanDiv = document.createElement("div");
          lifeSpanDiv.textContent = ` ᴇ.ᴠ. ${raza.lifeSpan || "?"}  `;
          lifeSpanDiv.style.flex = "1";
          lifeSpanDiv.style.textAlign = "center";
          lifeSpanDiv.style.color = "#fff";
          lifeSpanDiv.style.fontWeight = "bold";
          lifeSpanDiv.style.background = "rgba(255, 255, 255, 0.1)";
          lifeSpanDiv.style.padding = "10px";
          lifeSpanDiv.style.borderRadius = "10px";
          lifeSpanDiv.style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.3)";

          const speedDiv = document.createElement("div");
          speedDiv.textContent = `ᴠᴇʟ. ${raza.movementSpeed} c`;
          speedDiv.style.flex = "1";
          speedDiv.style.textAlign = "center";
          speedDiv.style.color = "#fff";
          speedDiv.style.fontWeight = "bold";
          speedDiv.style.background = "rgba(255, 255, 255, 0.1)";
          speedDiv.style.padding = "10px";
          speedDiv.style.borderRadius = "10px";
          speedDiv.style.boxShadow = "0 2px 4px rgba(0, 0, 0, 0.3)";

          sizeSpeedContainer.appendChild(sizesDiv);
          sizeSpeedContainer.appendChild(lifeSpanDiv);
          sizeSpeedContainer.appendChild(speedDiv);

          content.appendChild(sizeSpeedContainer);



          const habilitiesContainer = document.createElement("div");
          habilitiesContainer.classList.add("habilities-container");
          raza.abilities.forEach((ability) => {
            const abilityDiv = document.createElement("div");
            abilityDiv.classList.add("hability");
            abilityDiv.innerHTML = `<strong style="font-family: 'Cinzel'; font-size: 1.3rem;">${ability.name
              }</strong>: ${ability.description.replace(/\n/g, "<br>")}`;
            habilitiesContainer.appendChild(abilityDiv);
          });
          content.appendChild(habilitiesContainer);
          container.appendChild(content);
          charactersContainer.appendChild(container);
        }
      } catch (error) {
        console.error("Error cargando razas:", error);
      }
    }

    async function generateJSON() {
      const raceName = document.getElementById("raceName").value.trim();
      const raceDescription = document
        .getElementById("raceDescription")
        .value.trim();
      const bonusRules = document.getElementById("bonusRules").value.trim();
      const movementSpeed = document
        .getElementById("movementSpeed")
        .value.trim();
      const attributes = {
        strength: formatAttribute(
          document.getElementById("strength").value.trim()
        ),
        dexterity: formatAttribute(
          document.getElementById("dexterity").value.trim()
        ),
        constitution: formatAttribute(
          document.getElementById("constitution").value.trim()
        ),
        intelligence: formatAttribute(
          document.getElementById("intelligence").value.trim()
        ),
        wisdom: formatAttribute(
          document.getElementById("wisdom").value.trim()
        ),
        charisma: formatAttribute(
          document.getElementById("charisma").value.trim()
        ),
      };

      function formatAttribute(value) {
        const num = parseInt(value, 10);
        if (!isNaN(num)) {
          if (num > 0) {
            return `+${num}`;
          } else {
            return `${num}`;
          }
        }
        return "0";
      }
      const sizes = Array.from(
        document.querySelectorAll('.form-group input[type="checkbox"]:checked')
      ).map((cb) => parseInt(cb.value));

      const abilities = Array.from(
        document.getElementById("abilitiesContainer").children
      ).map((group) => {
        const inputs = group.querySelectorAll("input, textarea");
        return {
          name: inputs[0].value.trim(),
          description: inputs[1].value.trim(),
        };
      });
      const lifeSpan = document.getElementById("lifeSpan").value.trim();

      const jsonData = {
        raceName,
        raceDescription,
        bonusRules,
        movementSpeed,
        lifeSpan,
        attributes,
        sizes,
        abilities,
      };

      const jsonString = JSON.stringify(jsonData, null, 4);
      const blob = new Blob([jsonString], {
        type: "application/json",
      });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = `${raceName || "raza"}.json`;
      link.click();
      URL.revokeObjectURL(url);
      cerrarFormulario();
    }
    document
      .getElementById("searchBar")
      .addEventListener("input", (event) => {
        const query = event.target.value.toLowerCase();
        const characters = document.querySelectorAll(".character-container");
        characters.forEach((character) => {
          const name = character
            .querySelector(".character-title")
            .textContent.toLowerCase();
          if (name.includes(query)) {
            character.style.display = "";
          } else {
            character.style.display = "none";
          }
        });
      });
    document.addEventListener("DOMContentLoaded", () => {
      cargarRazas();
      const filterButtons = document.querySelectorAll(".filter-button");
      const charactersContainer = document.getElementById("characters");
      filterButtons.forEach(button => {
        button.addEventListener("click", () => {
          const attribute = button.getAttribute("data-attribute");
          button.classList.toggle("active");
          const activeFilters = Array.from(filterButtons)
            .filter(btn => btn.classList.contains("active"))
            .map(btn => btn.getAttribute("data-attribute"));
          const characters = charactersContainer.querySelectorAll(".character-container");
          characters.forEach(character => {
            const attributes = JSON.parse(character.getAttribute("data-attributes"));
            const isVisible = activeFilters.length === 0 || activeFilters.every(attr => parseInt(attributes[attr], 10) > 0);
            character.style.display = isVisible ? "" : "none";
          });
        });
      });

    });
  </script>
</body>

</html>